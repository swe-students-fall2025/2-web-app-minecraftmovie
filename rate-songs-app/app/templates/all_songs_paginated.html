{% extends "base.html" %}
{% block page_title %}All Songs{% endblock %}
{% block page_content %}
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <div style="padding:6px 10px;border-radius:6px;background:#e5e7eb;font-weight:600;">
      {{ current_user.username or "Username" }}
    </div>
    <a href="{{ url_for('profile.view_profile') }}" class="nav-link">View Profile</a>
  </div>

  <section style="border:2px solid #60a5fa;border-radius:10px;padding:12px;">
    <h1 style="font-weight:700;margin-bottom:8px;">All Songs</h1>
    <ol style="margin-left:1.25rem; line-height:1.7;">
      {% for s in items %}
        <li>{{ s.title }} | {{ s.artist }} | {{s.review}} | {{ s.rating }} ‚òÖ</li>
        <div class="song-actions">
          <a href="{{ url_for('edit.edit_song', id=s._id) }}" class="edit-btn" title="Edit">‚úèÔ∏è</a>
          <button
          class="delete-btn"
          onclick="openDeleteModal('{{ s._id }}', `{{ s.title|escape }}`)"
        >üóëÔ∏è</button>
        </div>
      {% else %}
        <li class="muted">No songs</li>
      {% endfor %}
    </ol>

    <div style="margin-top:14px;text-align:center;">
      {% if has_next %}
        <a class="button" href="{{ url_for('songs.all_songs', page=page+1) }}">Next Page</a>
      {% else %}
        <button class="button" disabled>Next Page</button>
      {% endif %}
    </div>
  </section>


  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h3>Delete Song</h3>
      <p id="modalText"></p>
      <div class="modal-buttons">
        <form id="deleteForm" method="POST">
          <button type="submit" class="confirm-btn">Yes, delete</button>
        </form>
        <button type="button" class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    function openDeleteModal(id, title) {
      const modal = document.getElementById("deleteModal");
      const text = document.getElementById("modalText");
      const form = document.getElementById("deleteForm");
  
      text.textContent = `Are you sure you want to delete "${title}"?`;
      form.action = `/songs/delete/${id}`;
      modal.style.display = "flex";
    }
  
    function closeDeleteModal() {
      document.getElementById("deleteModal").style.display = "none";
    }
  
    window.onclick = function (event) {
      const modal = document.getElementById("deleteModal");
      if (event.target === modal) closeDeleteModal();
    };
  </script>
{% endblock %}
